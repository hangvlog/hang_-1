<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    const concurrencyRequest = (urls, maxNum) => {
      return new Promise((resolve, reject) => {
        if (urls.length === 0) {
          resolve([])
          return;
        }
        const results = []
        let index = 0 //下一个下标
        let count = 0 //当前请求完成的数量
        const request = async () => {
          if (index === urls.length) return;
          const url = urls[index++]
          if (count < maxNum){
            
          }
          // try {
          //   const resp = await fetch(url);
          //   // resp 加入到results
          //   results[index] = resp;
          // } catch (e) {
          //   results[index] = e
          // } finally {
          //   count++
          //   if (count === urls.length) {
          //     resolve(results)
          //   }
          //   request()
          // }
        }

        // maxNum和urls.length取最小进行调用
        const times = Math.min(maxNum, urls.length);
        for (let i = 0; i < times; i++) {
          request();
        }
      })
    }
    const urls = []
    for (let i = 1; i <= 20; i++) {
      urls.push(`https://jsonplaceholder.typicode.com/todos/${i}`);
    }
    concurrencyRequest(urls, 3).then(res => {
      console.log(res)
    })
  </script>
</body>

</html>